# 用户拓展

用户可以使用 python3 拓展自己的驱动和断言，通过 `-x` 参数指定即可，参考命令如下

```shell
qas --test ops/example-docs/custom -x ops/x
```

用户拓展是一个 python3 包，

## __init__.py

其中必须包含 `__init__.py`，用户拓展需要在这个文件暴露，其中 `drivers/reporters` 会被用来作为驱动和报告

- `drivers`: `[string, class]`，驱动名称映射，这个字段的 key 可以被 `ctx.type` 字段
- `reporters`: `[string, class]`，报告名称映射，这个字段可以用于在命令行参数 `--reporter` 中指定报告的格式

## 驱动拓展

Driver [接口](/qas/driver/driver.py)，包含三个方法

- `__init__(self, args)`: 初始化方式，一般是创建 `client`，参数 `args` 来自于 `ctx.args`
- `name(self, req)`: 执行步骤默认名称，当 case 描述文件中不设置 name 时，会调用这个函数自动生成步骤名
- `do(self, req)`: 执行步骤逻辑，根据请求返回对应的结果，参数 `req` 来自于 `step.req`，返回结果到 `step.res`

一个简单的 `EchoDriver` 实现如下，这个驱动只是把请求直接返回

```python
from qas.driver import Driver


class EchoDriver(Driver):
    def __init__(self, args):
        pass

    def name(self, req):
        return "echo"

    def do(self, req):
        return req
```

## 报告拓展

Reporter [接口](/qas/reporter/reporter.py)，实现 report 方法即可

- `report(self, res: TestResult) -> str`: 输出报告

一个简单的 `SummaryReporter` 实现如下，这个报告仅输出跳过通过和失败的 case 数量

```python
import json

from qas.reporter import Reporter
from qas.result import TestResult


class SummaryReporter(Reporter):
    def report(self, res: TestResult) -> str:
        return json.dumps({
            "skip": res.case_skip,
            "pass": res.case_pass,
            "fail": res.case_fail,
        }, indent=2)
```

## 钩子拓展

```python

```

## 参考

- [样例](/ops/example-docs/custom)
- Python __init__.py 作用详解: <https://www.jianshu.com/p/73f7fbf75183>
