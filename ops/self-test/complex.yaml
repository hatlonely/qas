name: TestComplex
step:
  - ctx: shell
    req:
      command: qas --test ops/example-complex --reporter json
      decoder: json
    res:
      exitCode: 0
      json: {
        "directory": "ops/example-complex",
        "name": "example-complex",
        "isPass": true,
        "isErr": false,
        "err": "",
        "#elapse": "val > 0",
        "caseSucc": 3,
        "caseFail": 0,
        "caseSkip": 0,
        "currCaseSucc": 1,
        "currCaseFail": 0,
        "currCaseSkip": 0,
        "stepSucc": 9,
        "stepFail": 0,
        "stepSkip": 0,
        "assertionSucc": 6,
        "assertionFail": 0,
        "cases": [
          {
            "name": "case1",
            "#elapse": "val > 0",
            "isPass": true,
            "isSkip": false,
            "steps": [
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo -n ${KEY1}",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "val1",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo -n ${KEY1}",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "val1",
                      "stderr": ""
                    },
                    "assertions": [
                      {
                        "isPass": true,
                        "message": "OK",
                        "node": "exitCode",
                        "val": 0,
                        "expect": 0
                      },
                      {
                        "isPass": true,
                        "message": "OK",
                        "node": "stdout",
                        "val": "val1",
                        "expect": "val1"
                      }
                    ],
                    "assertionSucc": 2,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 2,
                "assertionFail": 0,
                "#elapse": "val > 0"
              }
            ],
            "beforeCaseSteps": [
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo before case",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "before case\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo before case",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "before case\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              }
            ],
            "afterCaseSteps": [
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo after case",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "after case\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo after case",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "after case\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              }
            ],
            "stepSucc": 3,
            "stepFail": 0,
            "assertionSucc": 2,
            "assertionFail": 0
          }
        ],
        "setups": [
          {
            "name": "setup1",
            "#elapse": "val > 0",
            "isPass": true,
            "isSkip": false,
            "steps": [
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo setup1 step1",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "setup1 step1\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo setup1 step1",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "setup1 step1\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              },
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo setup1 step2",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "setup1 step2\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo setup1 step2",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "setup1 step2\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              }
            ],
            "beforeCaseSteps": [],
            "afterCaseSteps": [],
            "stepSucc": 2,
            "stepFail": 0,
            "assertionSucc": 0,
            "assertionFail": 0
          },
          {
            "name": "setup2",
            "#elapse": "val > 0",
            "isPass": true,
            "isSkip": false,
            "steps": [
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo setup2 step1",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "setup2 step1\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo setup2 step1",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "setup2 step1\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              },
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo setup2 step2",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "setup2 step2\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo setup2 step2",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "setup2 step2\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              }
            ],
            "beforeCaseSteps": [],
            "afterCaseSteps": [],
            "stepSucc": 2,
            "stepFail": 0,
            "assertionSucc": 0,
            "assertionFail": 0
          }
        ],
        "teardowns": [
          {
            "name": "teardown1",
            "#elapse": "val > 0",
            "isPass": true,
            "isSkip": false,
            "steps": [
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo teardown1 step1",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "teardown1 step1\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo teardown1 step1",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "teardown1 step1\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              },
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo teardown1 step2",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "teardown1 step2\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo teardown1 step2",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "teardown1 step2\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              }
            ],
            "beforeCaseSteps": [],
            "afterCaseSteps": [],
            "stepSucc": 2,
            "stepFail": 0,
            "assertionSucc": 0,
            "assertionFail": 0
          },
          {
            "name": "teardown2",
            "#elapse": "val > 0",
            "isPass": true,
            "isSkip": false,
            "steps": [
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo teardown2 step1",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "teardown2 step1\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo teardown2 step1",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "teardown2 step1\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              },
              {
                "name": "echo",
                "ctx": "shell",
                "isSkip": false,
                "isPass": true,
                "req": {
                  "command": "echo teardown2 step2",
                  "envs": {
                    "KEY1": "val1"
                  },
                  "decoder": "text"
                },
                "res": {
                  "exitCode": 0,
                  "stdout": "teardown2 step2\n",
                  "stderr": ""
                },
                "subSteps": [
                  {
                    "isPass": true,
                    "isErr": false,
                    "err": "",
                    "req": {
                      "command": "echo teardown2 step2",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "teardown2 step2\n",
                      "stderr": ""
                    },
                    "assertions": [],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "assertionSucc": 0,
                "assertionFail": 0,
                "#elapse": "val > 0"
              }
            ],
            "beforeCaseSteps": [],
            "afterCaseSteps": [],
            "stepSucc": 2,
            "stepFail": 0,
            "assertionSucc": 0,
            "assertionFail": 0
          }
        ],
        "subTests": [
          {
            "directory": "ops/example-complex/subtest2",
            "name": "subtest2",
            "isPass": true,
            "isErr": false,
            "err": "",
            "#elapse": "val > 0",
            "caseSucc": 1,
            "caseFail": 0,
            "caseSkip": 0,
            "currCaseSucc": 1,
            "currCaseFail": 0,
            "currCaseSkip": 0,
            "stepSucc": 3,
            "stepFail": 0,
            "stepSkip": 0,
            "assertionSucc": 2,
            "assertionFail": 0,
            "cases": [
              {
                "name": "case3",
                "#elapse": "val > 0",
                "isPass": true,
                "isSkip": false,
                "steps": [
                  {
                    "name": "echo",
                    "ctx": "shell",
                    "isSkip": false,
                    "isPass": true,
                    "req": {
                      "command": "echo -n ${KEY1}",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "val1",
                      "stderr": ""
                    },
                    "subSteps": [
                      {
                        "isPass": true,
                        "isErr": false,
                        "err": "",
                        "req": {
                          "command": "echo -n ${KEY1}",
                          "envs": {
                            "KEY1": "val1"
                          },
                          "decoder": "text"
                        },
                        "res": {
                          "exitCode": 0,
                          "stdout": "val1",
                          "stderr": ""
                        },
                        "assertions": [
                          {
                            "isPass": true,
                            "message": "OK",
                            "node": "exitCode",
                            "val": 0,
                            "expect": 0
                          },
                          {
                            "isPass": true,
                            "message": "OK",
                            "node": "stdout",
                            "val": "val1",
                            "expect": "val1"
                          }
                        ],
                        "assertionSucc": 2,
                        "assertionFail": 0,
                        "#elapse": "val > 0"
                      }
                    ],
                    "assertionSucc": 2,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "beforeCaseSteps": [
                  {
                    "name": "echo",
                    "ctx": "shell",
                    "isSkip": false,
                    "isPass": true,
                    "req": {
                      "command": "echo before case",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "before case\n",
                      "stderr": ""
                    },
                    "subSteps": [
                      {
                        "isPass": true,
                        "isErr": false,
                        "err": "",
                        "req": {
                          "command": "echo before case",
                          "envs": {
                            "KEY1": "val1"
                          },
                          "decoder": "text"
                        },
                        "res": {
                          "exitCode": 0,
                          "stdout": "before case\n",
                          "stderr": ""
                        },
                        "assertions": [],
                        "assertionSucc": 0,
                        "assertionFail": 0,
                        "#elapse": "val > 0"
                      }
                    ],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "afterCaseSteps": [
                  {
                    "name": "echo",
                    "ctx": "shell",
                    "isSkip": false,
                    "isPass": true,
                    "req": {
                      "command": "echo after case",
                      "envs": {
                        "KEY1": "val1"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "after case\n",
                      "stderr": ""
                    },
                    "subSteps": [
                      {
                        "isPass": true,
                        "isErr": false,
                        "err": "",
                        "req": {
                          "command": "echo after case",
                          "envs": {
                            "KEY1": "val1"
                          },
                          "decoder": "text"
                        },
                        "res": {
                          "exitCode": 0,
                          "stdout": "after case\n",
                          "stderr": ""
                        },
                        "assertions": [],
                        "assertionSucc": 0,
                        "assertionFail": 0,
                        "#elapse": "val > 0"
                      }
                    ],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "stepSucc": 3,
                "stepFail": 0,
                "assertionSucc": 2,
                "assertionFail": 0
              }
            ],
            "setups": [],
            "teardowns": [],
            "subTests": []
          },
          {
            "directory": "ops/example-complex/subtest1",
            "name": "subtest1",
            "isPass": true,
            "isErr": false,
            "err": "",
            "#elapse": "val > 0",
            "caseSucc": 1,
            "caseFail": 0,
            "caseSkip": 0,
            "currCaseSucc": 1,
            "currCaseFail": 0,
            "currCaseSkip": 0,
            "stepSucc": 3,
            "stepFail": 0,
            "stepSkip": 0,
            "assertionSucc": 2,
            "assertionFail": 0,
            "cases": [
              {
                "name": "case2",
                "#elapse": "val > 0",
                "isPass": true,
                "isSkip": false,
                "steps": [
                  {
                    "name": "echo",
                    "ctx": "shell",
                    "isSkip": false,
                    "isPass": true,
                    "req": {
                      "command": "echo -n ${KEY1}",
                      "envs": {
                        "KEY1": "subval1",
                        "KEY2": "val2"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "subval1",
                      "stderr": ""
                    },
                    "subSteps": [
                      {
                        "isPass": true,
                        "isErr": false,
                        "err": "",
                        "req": {
                          "command": "echo -n ${KEY1}",
                          "envs": {
                            "KEY1": "subval1",
                            "KEY2": "val2"
                          },
                          "decoder": "text"
                        },
                        "res": {
                          "exitCode": 0,
                          "stdout": "subval1",
                          "stderr": ""
                        },
                        "assertions": [
                          {
                            "isPass": true,
                            "message": "OK",
                            "node": "exitCode",
                            "val": 0,
                            "expect": 0
                          },
                          {
                            "isPass": true,
                            "message": "OK",
                            "node": "stdout",
                            "val": "subval1",
                            "expect": "subval1"
                          }
                        ],
                        "assertionSucc": 2,
                        "assertionFail": 0,
                        "#elapse": "val > 0"
                      }
                    ],
                    "assertionSucc": 2,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "beforeCaseSteps": [
                  {
                    "name": "echo",
                    "ctx": "shell",
                    "isSkip": false,
                    "isPass": true,
                    "req": {
                      "command": "echo before case",
                      "envs": {
                        "KEY1": "subval1",
                        "KEY2": "val2"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "before case\n",
                      "stderr": ""
                    },
                    "subSteps": [
                      {
                        "isPass": true,
                        "isErr": false,
                        "err": "",
                        "req": {
                          "command": "echo before case",
                          "envs": {
                            "KEY1": "subval1",
                            "KEY2": "val2"
                          },
                          "decoder": "text"
                        },
                        "res": {
                          "exitCode": 0,
                          "stdout": "before case\n",
                          "stderr": ""
                        },
                        "assertions": [],
                        "assertionSucc": 0,
                        "assertionFail": 0,
                        "#elapse": "val > 0"
                      }
                    ],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "afterCaseSteps": [
                  {
                    "name": "echo",
                    "ctx": "shell",
                    "isSkip": false,
                    "isPass": true,
                    "req": {
                      "command": "echo after case",
                      "envs": {
                        "KEY1": "subval1",
                        "KEY2": "val2"
                      },
                      "decoder": "text"
                    },
                    "res": {
                      "exitCode": 0,
                      "stdout": "after case\n",
                      "stderr": ""
                    },
                    "subSteps": [
                      {
                        "isPass": true,
                        "isErr": false,
                        "err": "",
                        "req": {
                          "command": "echo after case",
                          "envs": {
                            "KEY1": "subval1",
                            "KEY2": "val2"
                          },
                          "decoder": "text"
                        },
                        "res": {
                          "exitCode": 0,
                          "stdout": "after case\n",
                          "stderr": ""
                        },
                        "assertions": [],
                        "assertionSucc": 0,
                        "assertionFail": 0,
                        "#elapse": "val > 0"
                      }
                    ],
                    "assertionSucc": 0,
                    "assertionFail": 0,
                    "#elapse": "val > 0"
                  }
                ],
                "stepSucc": 3,
                "stepFail": 0,
                "assertionSucc": 2,
                "assertionFail": 0
              }
            ],
            "setups": [],
            "teardowns": [],
            "subTests": []
          }
        ]
      }
